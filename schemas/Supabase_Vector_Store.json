{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Supabase Vector Store",
  "description": "Work with your data in Supabase Vector Store",
  "x-n8n-node-type": "vectorStoreSupabase",
  "x-n8n-version": [
    1,
    1.1,
    1.2,
    1.3
  ],
  "x-n8n-group": [
    "transform"
  ],
  "type": "object",
  "properties": {
    "ragStarterCallout": {
      "x-title": "Tip: Get a feel for vector stores in n8n with our",
      "default": "",
      "type": "string",
      "x-n8n-type": "callout"
    },
    "mode": {
      "x-title": "Operation Mode",
      "default": "retrieve",
      "type": "string",
      "enum": [
        "load",
        "insert",
        "retrieve",
        "retrieve-as-tool",
        "update"
      ],
      "x-enumNames": [
        "Get Many",
        "Insert Documents",
        "Retrieve Documents (As Vector Store for Chain/Tool)",
        "Retrieve Documents (As Tool for AI Agent)",
        "Update Documents"
      ],
      "x-enumDescriptions": [
        "Get many ranked documents from vector store for query",
        "Insert documents into vector store",
        "Retrieve documents from vector store to be used as vector store with AI nodes",
        "Retrieve documents from vector store to be used as tool with AI nodes",
        "Update documents in vector store by ID"
      ]
    },
    "toolName": {
      "x-title": "Name",
      "description": "Name of the vector store",
      "default": "",
      "x-displayOptions": {
        "show": {
          "@version": [
            {
              "_cnd": {
                "lte": 1.2
              }
            }
          ],
          "mode": [
            "retrieve-as-tool"
          ]
        }
      },
      "x-required": true,
      "type": "string"
    },
    "toolDescription": {
      "x-title": "Description",
      "description": "Explain to the LLM what this tool does, a good, specific description would allow LLMs to produce expected results much more often",
      "default": "",
      "x-displayOptions": {
        "show": {
          "mode": [
            "retrieve-as-tool"
          ]
        }
      },
      "x-required": true,
      "type": "string",
      "x-rows": 2
    },
    "tableName": {
      "x-title": "Table Name",
      "default": {
        "mode": "list",
        "value": ""
      },
      "x-required": true,
      "type": "object",
      "properties": {
        "__rl": {
          "type": "boolean",
          "const": true
        },
        "mode": {
          "type": "string",
          "enum": [
            "list",
            "id"
          ]
        },
        "value": {
          "type": "string"
        }
      },
      "required": [
        "mode",
        "value"
      ],
      "x-modes": [
        {
          "name": "list",
          "displayName": "From List",
          "type": "list"
        },
        {
          "name": "id",
          "displayName": "ID",
          "type": "string"
        }
      ]
    },
    "embeddingBatchSize": {
      "x-title": "Embedding Batch Size",
      "description": "Number of documents to embed in a single batch",
      "default": 200,
      "x-displayOptions": {
        "show": {
          "mode": [
            "insert"
          ],
          "@version": [
            {
              "_cnd": {
                "gte": 1.1
              }
            }
          ]
        }
      },
      "type": "number"
    },
    "options": {
      "x-title": "Options",
      "default": {},
      "x-displayOptions": {
        "show": {
          "mode": [
            "update"
          ]
        }
      },
      "type": "object",
      "properties": {
        "queryName": {
          "x-title": "Query Name",
          "description": "Name of the query to use for matching documents",
          "default": "match_documents",
          "type": "string"
        }
      }
    },
    "prompt": {
      "x-title": "Prompt",
      "description": "Search prompt to retrieve matching documents from the vector store using similarity-based ranking",
      "default": "",
      "x-displayOptions": {
        "show": {
          "mode": [
            "load"
          ]
        }
      },
      "x-required": true,
      "type": "string"
    },
    "topK": {
      "x-title": "Limit",
      "description": "Number of top results to fetch from vector store",
      "default": 4,
      "x-displayOptions": {
        "show": {
          "mode": [
            "load",
            "retrieve-as-tool"
          ]
        }
      },
      "type": "number"
    },
    "includeDocumentMetadata": {
      "x-title": "Include Metadata",
      "description": "Whether or not to include document metadata",
      "default": true,
      "x-displayOptions": {
        "show": {
          "mode": [
            "load",
            "retrieve-as-tool"
          ]
        }
      },
      "type": "boolean"
    },
    "useReranker": {
      "x-title": "Rerank Results",
      "description": "Whether or not to rerank results",
      "default": false,
      "x-displayOptions": {
        "show": {
          "mode": [
            "load",
            "retrieve",
            "retrieve-as-tool"
          ]
        }
      },
      "type": "boolean"
    },
    "id": {
      "x-title": "ID",
      "description": "ID of an embedding entry",
      "default": "",
      "x-displayOptions": {
        "show": {
          "mode": [
            "update"
          ]
        }
      },
      "x-required": true,
      "type": "string"
    }
  },
  "x-icon": "file:supabase.svg",
  "x-inputs": "={{\n\t\t\t((parameters) => {\n\t\t\t\tconst mode = parameters?.mode;\n\t\t\t\tconst useReranker = parameters?.useReranker;\n\t\t\t\tconst inputs = [{ displayName: \"Embedding\", type: \"ai_embedding\", required: true, maxConnections: 1}]\n\n\t\t\t\tif (['load', 'retrieve', 'retrieve-as-tool'].includes(mode) && useReranker) {\n\t\t\t\t\tinputs.push({ displayName: \"Reranker\", type: \"ai_reranker\", required: true, maxConnections: 1})\n\t\t\t\t}\n\n\t\t\t\tif (mode === 'retrieve-as-tool') {\n\t\t\t\t\treturn inputs;\n\t\t\t\t}\n\n\t\t\t\tif (['insert', 'load', 'update'].includes(mode)) {\n\t\t\t\t\tinputs.push({ displayName: \"\", type: \"main\"})\n\t\t\t\t}\n\n\t\t\t\tif (['insert'].includes(mode)) {\n\t\t\t\t\tinputs.push({ displayName: \"Document\", type: \"ai_document\", required: true, maxConnections: 1})\n\t\t\t\t}\n\t\t\t\treturn inputs\n\t\t\t})($parameter)\n\t\t}}",
  "x-outputs": "={{\n\t\t\t((parameters) => {\n\t\t\t\tconst mode = parameters?.mode ?? 'retrieve';\n\n\t\t\t\tif (mode === 'retrieve-as-tool') {\n\t\t\t\t\treturn [{ displayName: \"Tool\", type: \"ai_tool\"}]\n\t\t\t\t}\n\n\t\t\t\tif (mode === 'retrieve') {\n\t\t\t\t\treturn [{ displayName: \"Vector Store\", type: \"ai_vectorStore\"}]\n\t\t\t\t}\n\t\t\t\treturn [{ displayName: \"\", type: \"main\"}]\n\t\t\t})($parameter)\n\t\t}}",
  "x-credentials": [
    {
      "name": "supabaseApi",
      "required": true
    }
  ]
}
