{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Postgres PGVector Store",
  "description": "Work with your data in Postgresql with the PGVector extension",
  "x-n8n-node-type": "vectorStorePGVector",
  "x-n8n-version": [
    1,
    1.1,
    1.2,
    1.3
  ],
  "x-n8n-group": [
    "transform"
  ],
  "type": "object",
  "properties": {
    "ragStarterCallout": {
      "x-title": "Tip: Get a feel for vector stores in n8n with our",
      "default": "",
      "type": "string",
      "x-n8n-type": "callout"
    },
    "mode": {
      "x-title": "Operation Mode",
      "default": "retrieve",
      "type": "string",
      "enum": [
        "load",
        "insert",
        "retrieve",
        "retrieve-as-tool"
      ],
      "x-enumNames": [
        "Get Many",
        "Insert Documents",
        "Retrieve Documents (As Vector Store for Chain/Tool)",
        "Retrieve Documents (As Tool for AI Agent)"
      ],
      "x-enumDescriptions": [
        "Get many ranked documents from vector store for query",
        "Insert documents into vector store",
        "Retrieve documents from vector store to be used as vector store with AI nodes",
        "Retrieve documents from vector store to be used as tool with AI nodes"
      ]
    },
    "toolName": {
      "x-title": "Name",
      "description": "Name of the vector store",
      "default": "",
      "x-displayOptions": {
        "show": {
          "@version": [
            {
              "_cnd": {
                "lte": 1.2
              }
            }
          ],
          "mode": [
            "retrieve-as-tool"
          ]
        }
      },
      "x-required": true,
      "type": "string"
    },
    "toolDescription": {
      "x-title": "Description",
      "description": "Explain to the LLM what this tool does, a good, specific description would allow LLMs to produce expected results much more often",
      "default": "",
      "x-displayOptions": {
        "show": {
          "mode": [
            "retrieve-as-tool"
          ]
        }
      },
      "x-required": true,
      "type": "string",
      "x-rows": 2
    },
    "tableName": {
      "x-title": "Table Name",
      "description": "The table name to store the vectors in. If table does not exist, it will be created.",
      "default": "n8n_vectors",
      "type": "string"
    },
    "embeddingBatchSize": {
      "x-title": "Embedding Batch Size",
      "description": "Number of documents to embed in a single batch",
      "default": 200,
      "x-displayOptions": {
        "show": {
          "mode": [
            "insert"
          ],
          "@version": [
            {
              "_cnd": {
                "gte": 1.1
              }
            }
          ]
        }
      },
      "type": "number"
    },
    "options": {
      "x-title": "Options",
      "default": {},
      "x-displayOptions": {
        "show": {
          "mode": [
            "retrieve"
          ]
        }
      },
      "type": "object",
      "properties": {
        "distanceStrategy": {
          "x-title": "Distance Strategy",
          "description": "The method to calculate the distance between two vectors",
          "default": "cosine",
          "type": "string",
          "enum": [
            "cosine",
            "innerProduct",
            "euclidean"
          ],
          "x-enumNames": [
            "Cosine",
            "Inner Product",
            "Euclidean"
          ]
        },
        "collection": {
          "x-title": "Collection",
          "description": "Collection of vectors",
          "default": {
            "values": {
              "useCollection": false,
              "collectionName": "n8n",
              "collectionTable": "n8n_vector_collections"
            }
          },
          "type": "object",
          "properties": {
            "values": {
              "x-title": "Collection Settings",
              "type": "object",
              "properties": {
                "useCollection": {
                  "x-title": "Use Collection",
                  "default": false,
                  "type": "boolean"
                },
                "collectionName": {
                  "x-title": "Collection Name",
                  "default": "n8n",
                  "x-displayOptions": {
                    "show": {
                      "useCollection": [
                        true
                      ]
                    }
                  },
                  "x-required": true,
                  "type": "string"
                },
                "collectionTableName": {
                  "x-title": "Collection Table Name",
                  "default": "n8n_vector_collections",
                  "x-displayOptions": {
                    "show": {
                      "useCollection": [
                        true
                      ]
                    }
                  },
                  "x-required": true,
                  "type": "string"
                }
              }
            }
          }
        },
        "columnNames": {
          "x-title": "Column Names",
          "description": "The names of the columns in the PGVector table",
          "default": {
            "values": {
              "idColumnName": "id",
              "vectorColumnName": "embedding",
              "contentColumnName": "text",
              "metadataColumnName": "metadata"
            }
          },
          "type": "object",
          "properties": {
            "values": {
              "x-title": "Column Name Settings",
              "type": "object",
              "properties": {
                "idColumnName": {
                  "x-title": "ID Column Name",
                  "default": "id",
                  "x-required": true,
                  "type": "string"
                },
                "vectorColumnName": {
                  "x-title": "Vector Column Name",
                  "default": "embedding",
                  "x-required": true,
                  "type": "string"
                },
                "contentColumnName": {
                  "x-title": "Content Column Name",
                  "default": "text",
                  "x-required": true,
                  "type": "string"
                },
                "metadataColumnName": {
                  "x-title": "Metadata Column Name",
                  "default": "metadata",
                  "x-required": true,
                  "type": "string"
                }
              }
            }
          }
        },
        "metadata": {
          "x-title": "Metadata Filter",
          "description": "Metadata to filter the document by",
          "default": {},
          "type": "object",
          "properties": {
            "metadataValues": {
              "x-title": "Fields to Set",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "x-title": "Name",
                    "default": "",
                    "x-required": true,
                    "type": "string"
                  },
                  "value": {
                    "x-title": "Value",
                    "default": "",
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    },
    "prompt": {
      "x-title": "Prompt",
      "description": "Search prompt to retrieve matching documents from the vector store using similarity-based ranking",
      "default": "",
      "x-displayOptions": {
        "show": {
          "mode": [
            "load"
          ]
        }
      },
      "x-required": true,
      "type": "string"
    },
    "topK": {
      "x-title": "Limit",
      "description": "Number of top results to fetch from vector store",
      "default": 4,
      "x-displayOptions": {
        "show": {
          "mode": [
            "load",
            "retrieve-as-tool"
          ]
        }
      },
      "type": "number"
    },
    "includeDocumentMetadata": {
      "x-title": "Include Metadata",
      "description": "Whether or not to include document metadata",
      "default": true,
      "x-displayOptions": {
        "show": {
          "mode": [
            "load",
            "retrieve-as-tool"
          ]
        }
      },
      "type": "boolean"
    },
    "useReranker": {
      "x-title": "Rerank Results",
      "description": "Whether or not to rerank results",
      "default": false,
      "x-displayOptions": {
        "show": {
          "mode": [
            "load",
            "retrieve",
            "retrieve-as-tool"
          ]
        }
      },
      "type": "boolean"
    },
    "id": {
      "x-title": "ID",
      "description": "ID of an embedding entry",
      "default": "",
      "x-displayOptions": {
        "show": {
          "mode": [
            "update"
          ]
        }
      },
      "x-required": true,
      "type": "string"
    }
  },
  "x-icon": "file:postgres.svg",
  "x-inputs": "={{\n\t\t\t((parameters) => {\n\t\t\t\tconst mode = parameters?.mode;\n\t\t\t\tconst useReranker = parameters?.useReranker;\n\t\t\t\tconst inputs = [{ displayName: \"Embedding\", type: \"ai_embedding\", required: true, maxConnections: 1}]\n\n\t\t\t\tif (['load', 'retrieve', 'retrieve-as-tool'].includes(mode) && useReranker) {\n\t\t\t\t\tinputs.push({ displayName: \"Reranker\", type: \"ai_reranker\", required: true, maxConnections: 1})\n\t\t\t\t}\n\n\t\t\t\tif (mode === 'retrieve-as-tool') {\n\t\t\t\t\treturn inputs;\n\t\t\t\t}\n\n\t\t\t\tif (['insert', 'load', 'update'].includes(mode)) {\n\t\t\t\t\tinputs.push({ displayName: \"\", type: \"main\"})\n\t\t\t\t}\n\n\t\t\t\tif (['insert'].includes(mode)) {\n\t\t\t\t\tinputs.push({ displayName: \"Document\", type: \"ai_document\", required: true, maxConnections: 1})\n\t\t\t\t}\n\t\t\t\treturn inputs\n\t\t\t})($parameter)\n\t\t}}",
  "x-outputs": "={{\n\t\t\t((parameters) => {\n\t\t\t\tconst mode = parameters?.mode ?? 'retrieve';\n\n\t\t\t\tif (mode === 'retrieve-as-tool') {\n\t\t\t\t\treturn [{ displayName: \"Tool\", type: \"ai_tool\"}]\n\t\t\t\t}\n\n\t\t\t\tif (mode === 'retrieve') {\n\t\t\t\t\treturn [{ displayName: \"Vector Store\", type: \"ai_vectorStore\"}]\n\t\t\t\t}\n\t\t\t\treturn [{ displayName: \"\", type: \"main\"}]\n\t\t\t})($parameter)\n\t\t}}",
  "x-credentials": [
    {
      "name": "postgres",
      "required": true,
      "testedBy": "postgresConnectionTest"
    }
  ]
}
