{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Switch",
  "description": "Route items depending on defined expression or rules",
  "x-n8n-node-type": "switch",
  "x-n8n-version": 3.2,
  "x-n8n-group": [
    "transform"
  ],
  "type": "object",
  "properties": {
    "mode": {
      "x-title": "Mode",
      "description": "How data should be routed",
      "default": "rules",
      "type": "string",
      "enum": [
        "rules",
        "expression"
      ],
      "x-enumNames": [
        "Rules",
        "Expression"
      ],
      "x-enumDescriptions": [
        "Build a matching rule for each output",
        "Write an expression to return the output index"
      ]
    },
    "numberOutputs": {
      "x-title": "Number of Outputs",
      "description": "How many outputs to create",
      "default": 4,
      "x-displayOptions": {
        "show": {
          "mode": [
            "expression"
          ],
          "@version": [
            {
              "_cnd": {
                "lt": 3.3
              }
            }
          ]
        }
      },
      "type": "number"
    },
    "output": {
      "x-title": "Output Index",
      "description": "The output index to send the input item to. Use an expression to calculate which input item should be routed to which output. The expression must return a number.",
      "default": "={{}}",
      "x-displayOptions": {
        "show": {
          "mode": [
            "expression"
          ]
        }
      },
      "type": "number"
    },
    "rules": {
      "x-title": "Routing Rules",
      "default": {
        "values": [
          {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict"
              },
              "conditions": [
                {
                  "leftValue": "",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            }
          }
        ]
      },
      "x-displayOptions": {
        "show": {
          "mode": [
            "rules"
          ]
        }
      },
      "type": "object",
      "properties": {
        "values": {
          "x-title": "Routing Rule",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "conditions": {
                "x-title": "Conditions",
                "default": {},
                "type": "object",
                "properties": {
                  "conditions": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "leftValue": {
                          "type": "string"
                        },
                        "rightValue": {},
                        "operator": {
                          "type": "object"
                        }
                      }
                    }
                  },
                  "combinator": {
                    "type": "string",
                    "enum": [
                      "and",
                      "or"
                    ],
                    "default": "and"
                  },
                  "options": {
                    "type": "object",
                    "properties": {
                      "caseSensitive": {
                        "type": "boolean"
                      },
                      "leftValue": {
                        "type": "string"
                      },
                      "typeValidation": {
                        "type": "string"
                      }
                    }
                  }
                }
              },
              "renameOutput": {
                "x-title": "Rename Output",
                "default": false,
                "type": "boolean"
              },
              "outputKey": {
                "x-title": "Output Name",
                "description": "The label of output to which to send data to if rule matches",
                "default": "",
                "x-displayOptions": {
                  "show": {
                    "renameOutput": [
                      true
                    ]
                  }
                },
                "type": "string"
              }
            }
          }
        }
      }
    },
    "looseTypeValidation": {
      "x-title": "Convert types where required",
      "description": "If the type of an expression doesn't match the type of the comparison, n8n will try to cast the expression to the required type. E.g. for booleans <code>\"false\"</code> or <code>0</code> will be cast to <code>false</code>",
      "default": false,
      "x-displayOptions": {
        "show": {
          "@version": [
            {
              "_cnd": {
                "gte": 3.1
              }
            }
          ]
        }
      },
      "type": "boolean"
    },
    "options": {
      "x-title": "Options",
      "default": {},
      "x-displayOptions": {
        "show": {
          "mode": [
            "rules"
          ]
        }
      },
      "type": "object",
      "properties": {
        "fallbackOutput": {
          "x-title": "Fallback Output",
          "description": "If no rule matches the item will be sent to this output, by default they will be ignored",
          "default": "none",
          "type": "string"
        },
        "ignoreCase": {
          "x-title": "Ignore Case",
          "description": "Whether to ignore letter case when evaluating conditions",
          "default": true,
          "type": "boolean"
        },
        "looseTypeValidation": {
          "x-title": "Convert types where required",
          "description": "If the type of an expression doesn't match the type of the comparison, n8n will try to cast the expression to the required type. E.g. for booleans <code>\"false\"</code> or <code>0</code> will be cast to <code>false</code>",
          "default": true,
          "x-displayOptions": {
            "show": {
              "@version": [
                {
                  "_cnd": {
                    "lt": 3.1
                  }
                }
              ]
            }
          },
          "type": "boolean"
        },
        "renameFallbackOutput": {
          "x-title": "Rename Fallback Output",
          "default": "",
          "x-displayOptions": {
            "show": {
              "fallbackOutput": [
                "extra"
              ]
            }
          },
          "type": "string"
        },
        "allMatchingOutputs": {
          "x-title": "Send data to all matching outputs",
          "description": "Whether to send data to all outputs meeting conditions (and not just the first one)",
          "default": false,
          "type": "boolean"
        }
      }
    }
  },
  "x-subtitle": "=mode: {{(function capitalize(str) {\n    if (!str)\n        return str;\n    const chars = str.split('');\n    chars[0] = chars[0].toUpperCase();\n    return chars.join('');\n})($parameter[\"mode\"])}}",
  "x-icon": "fa:map-signs",
  "x-inputs": [
    "main"
  ],
  "x-outputs": "={{((parameters) => {\n    const mode = parameters.mode;\n    if (mode === 'expression') {\n        return Array.from({ length: parameters.numberOutputs }, (_, i) => ({\n            type: 'main',\n            displayName: i.toString(),\n        }));\n    }\n    else {\n        const rules = parameters.rules?.values ?? [];\n        const ruleOutputs = rules.map((rule, index) => {\n            return {\n                type: 'main',\n                displayName: rule.outputKey || index.toString(),\n            };\n        });\n        if (parameters.options?.fallbackOutput === 'extra') {\n            const renameFallbackOutput = parameters.options?.renameFallbackOutput;\n            ruleOutputs.push({\n                type: 'main',\n                displayName: renameFallbackOutput || 'Fallback',\n            });\n        }\n        return ruleOutputs;\n    }\n})($parameter)}}"
}
